#!/bin/bash

set -e

bitcoind -regtest -connect=0.0.0.0 -daemon
sleep 5

echo createwallet
bitcoin-cli -regtest -named createwallet wallet_name= descriptors=false


echo decodepsbt
bitcoin-cli -regtest decodepsbt cHNidP8BAFICAAAAAXbwJkwsgxIRKLjRxXi6OfNBpJQCVfh2H7Rihe6yb+0kAQAAAAD/////AQxKTAAAAAAAFgAUpBDHZKyNoStXigYCfxHgLwe34dMAAAAAAAEAfQIAAAABnM80q7NikSXBhb+p6YRuSeTMcZx/2sXGeU8esKX7FRYBAAAAAP////8CIEE9AgAAAAAWABSfuXaMwu9fCvfplXFh3NGwDhS3r0BLTAAAAAAAIgAgZchjx1AzHMA++02sohfnklz/h/XpypknVkI0vg1ieOgAAAAAAQErQEtMAAAAAAAiACBlyGPHUDMcwD77TayiF+eSXP+H9enKmSdWQjS+DWJ46AEFi1IhA9FN3PtoF/VXlpW7s+s+GFiHvylCsDHm9xY0O4/n6ejiIQKPzUb4YUssvzGAlpaCQqHiK8+22PK23JOcjCfDR7KTeyEDFay1UBIPTNy0YNXEkICrUIykzNje3srCL+6sjNAX1MEhAisGPuLyL54ZgsFA/neGcsaDERp5bczNvUe7ZePWCKmDVK4AAA==

echo decodescript
bitcoin-cli -regtest decodescript 522103d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e221028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b210315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c121022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a98354ae


echo importmulti
bitcoin-cli -regtest importmulti '[{
  "scriptPubKey": {"address": "bcrt1qvhyx836sxvwvq0hmfkk2y9l8jfw0lpl4a89fjf6kgg6turtz0r5q2wgvlj"},
  "timestamp": "now",
  "watchonly": true,
  "witnessscript": "522103d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e221028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b210315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c121022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a98354ae"
}]'

echo getaddressinfo
bitcoin-cli -regtest getaddressinfo bcrt1qvhyx836sxvwvq0hmfkk2y9l8jfw0lpl4a89fjf6kgg6turtz0r5q2wgvlj

echo import first privkey
bitcoin-cli -regtest importprivkey cQCrT9Ncs9729ao7jbmAWrD9z7tF64s2yKzmD6nkiLAi9sXVZWAn cf012ce88841b4f8a85f650481eeaa863b50126ebcfc5d9fe7c393d25e9f30a4
bitcoin-cli -regtest getaddressesbylabel cf012ce88841b4f8a85f650481eeaa863b50126ebcfc5d9fe7c393d25e9f30a4
bitcoin-cli -regtest getaddressinfo mn1f471kQHYx9oUnwc4TUy9KzbMx9847Dk

echo import second privkey
bitcoin-cli -regtest importprivkey cP65UeSDZPiTLB6CBwasWv9oJYEjRgQXhswfwcT9HscEKDcEbgy4 53c1357034bb830e227548db751a75febfc75bf7b5443f24a0fb4586550ed888
bitcoin-cli -regtest getaddressesbylabel 53c1357034bb830e227548db751a75febfc75bf7b5443f24a0fb4586550ed888
bitcoin-cli -regtest getaddressinfo 2NDCUqLt98QfR23XqLry1hDG1Tms1RquiQn

echo walletprocesspsbt
bitcoin-cli -regtest walletprocesspsbt cHNidP8BAFICAAAAAXbwJkwsgxIRKLjRxXi6OfNBpJQCVfh2H7Rihe6yb+0kAQAAAAD/////AQxKTAAAAAAAFgAUpBDHZKyNoStXigYCfxHgLwe34dMAAAAAAAEAfQIAAAABnM80q7NikSXBhb+p6YRuSeTMcZx/2sXGeU8esKX7FRYBAAAAAP////8CIEE9AgAAAAAWABSfuXaMwu9fCvfplXFh3NGwDhS3r0BLTAAAAAAAIgAgZchjx1AzHMA++02sohfnklz/h/XpypknVkI0vg1ieOgAAAAAAQErQEtMAAAAAAAiACBlyGPHUDMcwD77TayiF+eSXP+H9enKmSdWQjS+DWJ46AEFi1IhA9FN3PtoF/VXlpW7s+s+GFiHvylCsDHm9xY0O4/n6ejiIQKPzUb4YUssvzGAlpaCQqHiK8+22PK23JOcjCfDR7KTeyEDFay1UBIPTNy0YNXEkICrUIykzNje3srCL+6sjNAX1MEhAisGPuLyL54ZgsFA/neGcsaDERp5bczNvUe7ZePWCKmDVK4AAA== true ALL false

echo finalizepsbt
bitcoin-cli -regtest finalizepsbt cHNidP8BAFICAAAAAXbwJkwsgxIRKLjRxXi6OfNBpJQCVfh2H7Rihe6yb+0kAQAAAAD/////AQxKTAAAAAAAFgAUpBDHZKyNoStXigYCfxHgLwe34dMAAAAAAAEAfQIAAAABnM80q7NikSXBhb+p6YRuSeTMcZx/2sXGeU8esKX7FRYBAAAAAP////8CIEE9AgAAAAAWABSfuXaMwu9fCvfplXFh3NGwDhS3r0BLTAAAAAAAIgAgZchjx1AzHMA++02sohfnklz/h/XpypknVkI0vg1ieOgAAAAAAQErQEtMAAAAAAAiACBlyGPHUDMcwD77TayiF+eSXP+H9enKmSdWQjS+DWJ46AEI/R4BBABHMEQCIFBMZUSRDB/NbDzBZh0RKEppRUYoKqo0X2JIdldXfs/qAiBHh0wwVkowkb8bc7X1/ydzBxBZ0NU65eSG70Uo5x+EswFHMEQCIC5Odq7jvt93YghnXw2bYDI5EEYEpECGYevWFPEB/JXZAiBdWKVQTQN/EU58Ik6yJC6ICR3dupXhdIqqZPjKr5MUAgGLUiED0U3c+2gX9VeWlbuz6z4YWIe/KUKwMeb3FjQ7j+fp6OIhAo/NRvhhSyy/MYCWloJCoeIrz7bY8rbck5yMJ8NHspN7IQMVrLVQEg9M3LRg1cSQgKtQjKTM2N7eysIv7qyM0BfUwSECKwY+4vIvnhmCwUD+d4ZyxoMRGnltzM29R7tl49YIqYNUrgAA

echo decoderawtransaction
bitcoin-cli -regtest decoderawtransaction 0200000000010176f0264c2c83121128b8d1c578ba39f341a4940255f8761fb46285eeb26fed240100000000ffffffff010c4a4c0000000000160014a410c764ac8da12b578a06027f11e02f07b7e1d304004730440220504c6544910c1fcd6c3cc1661d11284a694546282aaa345f62487657577ecfea022047874c30564a3091bf1b73b5f5ff2773071059d0d53ae5e486ef4528e71f84b30147304402202e4e76aee3bedf776208675f0d9b603239104604a4408661ebd614f101fc95d902205d58a5504d037f114e7c224eb2242e88091dddba95e1748aaa64f8caaf931402018b522103d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e221028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b210315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c121022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a98354ae00000000



echo stop
bitcoin-cli -regtest stop
sleep 2
rm -rf ~/.bitcoin
