#!/bin/bash
set -e

# Test large withdrawal transactions. This spends 7 inputs from an older
# Glacier address with uncompressed, non-segwit keys.


# Simulate an earlier, even-larger transaction. These files should
# get deleted by glacierscript.
touch transaction-01.png transaction-02.png transaction-03.png


$GLACIERSCRIPT --regtest=$1 create-withdrawal-data << INPUT 2>&1
y
y
y
y
y
y
2MyCc3oEVwSYzgmspKTjZ6HZrzeg8ajdmKR
52410498137b6223a9fa395e16fe6e49a7f4a737029d4476ec35844a8469e358d641b85a5bf355d570699d63cde87da1d450e1966d97ee61a99b51995a11eb7ea0f6744104fd9a69f95e31c3b8d2c97925e0f151dd1c67f3b71e3ba6db8f20d944e6e94d9b5e3ad4c12a5f9bd6d2137cf69b015f9637de61aafae29fdfccf8ef5a4cd81e374104ff188a131ee79900a4cdbe68c5ea84ad73b8acf8414e5895f6c7b0e4779ef50d39ba369a34cd3f7216877769a292ccf52c2653c799a138321bf8c1e03a9120594104eeafc0621008662a9977b953ee7f7af87981830f561cac50387211c75d58bcb751414fc9abe0cf4a28a4044806ccd54b3f80ba990e0eff046bb1b930968b973a54ae
bcrt1qrwxllgvtc0ns624dlped894kkfq608jmye2k50
7
020000000001018caead1085208cd5935ad3c664a9012d27ab5b68914ca92a00e3fd473e0064fe0100000000ffffffff0242e419000000000017a914385ceedba0a97aa2d9ae88f8140ddd9524e6cdd88740420f000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d578702473044022017a062240a923e3aab2f4d1383f49c574802947327854fe8fd3a4bbd16387aae0220457ad85a584c4bacbe67de855c5845d8b068f6611fd5317899ddf799e88518c7012102f5455327f645f6b6c44fbaf03d56fd65cba828961239960a3284cd43a889057300000000
02000000000101890e34008e161df145c6402e12ea37daebda3284ce78d75f5ab83d0392a5e4950100000017160014713a9050f95ee7ce6da75ecd2713bc809f184118ffffffff02866072000000000017a914f3fadb6de38d8a2f3cfac4c96eb6822ed88e44b38740420f000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d57870247304402207510c0a02938482ebf68094bfd727f4c61e33da5da47768c2e95e5b908146503022072fd073d118abbf30efed204236c253b2c6a34aedfb83fa616cd2fe165e76ce5012102a19f9119892ec588beacf5c39fed2c37bdd7318037e88e394052ccc86858129700000000
020000000001019e1e0700bccde9c9d298cbae277422a209d987a4acc39920fc01067289a97e500100000000ffffffff0290c4c0010000000017a91406eef6c60b644bb80f28af6953bc407fb70757fa8750690f000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d5787024730440220024bdeec3bf8bdce463b910e8a09edebdaa3ff1da62d665b76b8931688a48c4502207f7b3625f82cf7c81c7e8f91e74f8813d4ba0b583dd182866353948c07c4bb430121029860dc0d45559ab5a2ef437f9ff1ec4f867c5b9fe30cb3dee408aa2d11ad4c2700000000
02000000000101b24be14309852d8c5a793040e1478a9e4c0c9c53820b1752a0bd31c15a006a480100000017160014023e4b8e3e3b3432beecf3ebe95876690dbfbd1fffffffff0280de0f000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d5787608162000000000017a914b831ebd24f0a47a9e610e173f9e93083b6f87868870247304402205a43936c98d0773e3578725f8f357017d35126c47109061576186a25d9ef216b02200db7d2c05b4df4f4f62de01be886d29a87b2702ad2b21641e8980fe89605840b012102830fb7998dd6d3a4686fe31832e9255ea5efafd79448a5b5f0958ad5cdbbcd5a00000000
02000000000101729b3b506b3197a3f7fdf87a5ce0be665b96ebe6bf901c555b827f30ba6bd0b001000000171600148a6c1aa3af05f9da1d05545d7f2634c468f90df8ffffffff022a7b52000000000017a914b330855b088486013ed13bf2cfd134c516f48cda87900510000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d57870247304402204ffac3ce0c483e6f2f2ff42c77f7890e5454a4d02b53ed36de6551bfe0c6b0fa022036dd0e96c97befdc2b40c8d460b0373e152f1a723e166fddc220534b2d61ee38012103595c5f5649e7a92aab69a9b1e9c1e6b8a486de71de804488499c2c6fbe41d30200000000
020000000001011e8bbd0010a1af21ac583cd5da68c4e1fe6c6c919a477431991a8c74409a80970100000017160014e47ceb06bc19e2ca4327b1cd7fe9c30b7266a323ffffffff02a02c10000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d57874a97b0010000000017a9141a4274c41f51b370c0370b4dd58608575f36c14687024730440220089c7edd22a4796ea6b2eddd16ce0be14312e4bddc08d58c2f3f37858c7b70ff022049f88cda7f6952d0d68ebdca92e8f9d8fa9cba8c4b344e99b45e29292d19be60012103db82b75ec69868dd2d9d54652b8c0c081c72249a36c62db4b653cfb51bd208d600000000
020000000001011209dfd41254076b6a49e874cd5cf6e9943e7c6ddab5f96929be5c53bf03057601000000171600149dd2579d7b67fa89a69030220ed0a03efc7c9043ffffffff02b05310000000000017a9144151ec0c95327edca1c4c5d38d01e00d9ec93d5787f442a0010000000017a914e62ccee61b66e8ee7062018a1db17294b22396c8870247304402204272b5f7dc2531dc2bbf8bd70c23567eef5052d0e35e5bb803cc291eaa8768f502206f67e36e5480745933fc26ff1fd6cf7285699bb2567498ae5f89be1b1c8a2ac0012102e0ff4bd2ea8884f978b80dfd0ce9e5b0aa211942471180874a002172e7694d0400000000
2
93VDtjySSuPjgLYyCR6BBTqCuaqu6X728ZfkNEDbgAdVURRd1rS
924WjH7yMYyuyhUougBHEu2vThcHRmahF6FsKvNVQBwSGuEyqKm
1
y

y
INPUT

ls -1 transaction*.png
