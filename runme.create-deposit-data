#!/bin/bash

set -e

bitcoind -regtest -connect=0.0.0.0 -daemon
sleep 5

echo createwallet
bitcoin-cli -regtest -named createwallet wallet_name= descriptors=false

echo getdescriptorinfo to get pubkey for 1st privkey
bitcoin-cli -regtest getdescriptorinfo \
  "pkh(cQCrT9Ncs9729ao7jbmAWrD9z7tF64s2yKzmD6nkiLAi9sXVZWAn)"
# The pubkey is displayed in the "descriptor" returned by getdescriptorinfo:
#  "descriptor": "pkh(03d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e2)#zl6jwflg",

echo getdescriptorinfo to get pubkey for 2nd privkey
bitcoin-cli -regtest getdescriptorinfo \
  "pkh(cP65UeSDZPiTLB6CBwasWv9oJYEjRgQXhswfwcT9HscEKDcEbgy4)"
# The pubkey is displayed in the "descriptor" returned by getdescriptorinfo:
#  "descriptor": "pkh(028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b)#5qd20afp",

echo getdescriptorinfo to get pubkey for 3rd privkey
bitcoin-cli -regtest getdescriptorinfo \
  "pkh(cNYaH3onqrdMffpznhMMmrHn34fuTU59w5j8LM3H42VPcUsLeXy5)"
# The pubkey is displayed in the "descriptor" returned by getdescriptorinfo:
#  "descriptor": "pkh(0315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c1)#4qczgv6g",

echo getdescriptorinfo to get pubkey for 4th privkey
bitcoin-cli -regtest getdescriptorinfo \
  "pkh(cRoydfinDRzzRQJp5niqJWukSYTfPJQM6ytqGN6nzonaz1mafgwD)"
# The pubkey is displayed in the "descriptor" returned by getdescriptorinfo:
#  "descriptor": "pkh(022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a983)#yu9qlj5a",


echo getdescriptorinfo to get checksum
bitcoin-cli -regtest getdescriptorinfo \
  "wsh(multi(2,03d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e2,028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b,0315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c1,022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a983))"

echo deriveaddresses
bitcoin-cli -regtest deriveaddresses \
  "wsh(multi(2,03d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e2,028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b,0315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c1,022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a983))#ryqpxn8d"
#[
#  "bcrt1qvhyx836sxvwvq0hmfkk2y9l8jfw0lpl4a89fjf6kgg6turtz0r5q2wgvlj"
#]



echo stop
bitcoin-cli -regtest stop
sleep 2
rm -rf ~/.bitcoin
