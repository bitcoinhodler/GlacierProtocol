#!/bin/bash

set -e

bitcoind -regtest -connect=0.0.0.0 -daemon
sleep 5

echo createwallet
bitcoin-cli -regtest -named createwallet wallet_name= descriptors=true


echo getdescriptorinfo to get checksum and pubkey version of descriptor
bitcoin-cli -regtest getdescriptorinfo \
  "wsh(multi(2,cQCrT9Ncs9729ao7jbmAWrD9z7tF64s2yKzmD6nkiLAi9sXVZWAn,cP65UeSDZPiTLB6CBwasWv9oJYEjRgQXhswfwcT9HscEKDcEbgy4,cNYaH3onqrdMffpznhMMmrHn34fuTU59w5j8LM3H42VPcUsLeXy5,cRoydfinDRzzRQJp5niqJWukSYTfPJQM6ytqGN6nzonaz1mafgwD))"

echo deriveaddresses
bitcoin-cli -regtest deriveaddresses \
  "wsh(multi(2,03d14ddcfb6817f5579695bbb3eb3e185887bf2942b031e6f716343b8fe7e9e8e2,028fcd46f8614b2cbf318096968242a1e22bcfb6d8f2b6dc939c8c27c347b2937b,0315acb550120f4cdcb460d5c49080ab508ca4ccd8dedecac22feeac8cd017d4c1,022b063ee2f22f9e1982c140fe778672c683111a796dcccdbd47bb65e3d608a983))#ryqpxn8d"
#[
#  "bcrt1qvhyx836sxvwvq0hmfkk2y9l8jfw0lpl4a89fjf6kgg6turtz0r5q2wgvlj"
#]

### Need to find redeem script, even though user doesn't really need
### this anymore with modern PSBT flow.
echo importdescriptors
bitcoin-cli -regtest importdescriptors '[{
  "desc": "wsh(multi(2,cQCrT9Ncs9729ao7jbmAWrD9z7tF64s2yKzmD6nkiLAi9sXVZWAn,cP65UeSDZPiTLB6CBwasWv9oJYEjRgQXhswfwcT9HscEKDcEbgy4,cNYaH3onqrdMffpznhMMmrHn34fuTU59w5j8LM3H42VPcUsLeXy5,cRoydfinDRzzRQJp5niqJWukSYTfPJQM6ytqGN6nzonaz1mafgwD))#pfvf3wgj",
  "timestamp": "now"
}]'

echo getaddressinfo
bitcoin-cli -regtest getaddressinfo "bcrt1qvhyx836sxvwvq0hmfkk2y9l8jfw0lpl4a89fjf6kgg6turtz0r5q2wgvlj"


echo stop
bitcoin-cli -regtest stop
sleep 2
rm -rf ~/.bitcoin
